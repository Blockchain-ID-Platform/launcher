box: google/golang

build:
  steps:
    - script:
      name: go test
      code: go test ./...

    - script:
      name: go build
      code: go build launch.go

deploy:
  steps:
    - script:
        name: update tags
        code: git fetch --tags
    - script:
        name: get highest version from tags
        code: export VERSION=$(sh incrementVersion.sh)
    - script:
        name: add new annotated tag
        code: git tag -a $VERSION -m "Tagging release version $VERSION"
    - script:
        name: push newly added tag
        code: git push origin $VERSION    
    - github-create-release:
        token: $GITHUB_TOKEN
        tag: $VERSION
    - github-upload-asset:
        token: $GITHUB_TOKEN
        file: launch
        content_type: application/octet-stream
